#Recurrent Neural Networks (RNNs)

```{r}
# Import the Libraries
library(tensorflow)
library(caret)
library(magrittr)
library(keras)

# Load data
training <- read.csv("train.csv")
testing <- read.csv("test.csv")

# Preprocess data
x_train <- as.matrix(training[, -ncol(training)])
y_train <- as.matrix(training[, ncol(training)])
x_test <- as.matrix(testing[, -ncol(testing)])
y_test <- as.matrix(testing[, ncol(testing)])

# Reshape the data
x_train <- array_reshape(x_train, c(nrow(x_train), ncol(x_train), 1))
x_test <- array_reshape(x_test, c(nrow(x_test), ncol(x_test), 1))

# Define model
model <- keras_model_sequential() %>%
  layer_lstm(units = 64, input_shape = c(ncol(x_train), 1), return_sequences = TRUE) %>%
  layer_dropout(rate = 0.2) %>%
  layer_lstm(units = 32, return_sequences = FALSE) %>%
  layer_dropout(rate = 0.2) %>%
  layer_dense(units = 1, activation = "sigmoid")

# Compile model
model %>% compile(
  optimizer = optimizer_adam(learning_rate = 0.001),
  loss = "binary_crossentropy",
  metrics = c("accuracy")
)

# Train model
history <- model %>% fit(
  x = x_train,
  y = y_train,
  validation_split = 0.2,
  epochs = 50,
  batch_size = 32)

# Check the number of columns in the training and testing data
ncol_train <- ncol(x_train)
ncol_test <- ncol(x_test)

# If the number of columns is different, add a column of zeros to the testing data
if (ncol_train != ncol_test) {
  missing_features <- ncol_train - ncol_test
  
  # Load the abind package
  library(abind)
  
  # Add the required columns to x_test with zeros
  x_test <- abind(x_test, array(0, dim = c(nrow(x_test), missing_features, 1)), along = 2)
}

# Reshape the data
x_train <- array_reshape(x_train, c(nrow(x_train), ncol(x_train), 1))
x_test <- array_reshape(x_test, c(nrow(x_test), ncol(x_test), 1))

# Evaluate model on test set
scores <- model %>% evaluate(
  x = x_test,
  y = y_test,
  verbose = 0
)

# Redirect the output to a file
sink("output.txt")

# Print test set accuracy
cat("Test accuracy:", scores[[2]], "\n")

# Create a PDF file for the plots
pdf("plots.pdf")

# Plot the training & validation accuracy values
plot(history$metrics$accuracy, main = "Model Accuracy", xlab = "Epoch", ylab = "Accuracy", type = "l", col = "blue", ylim = c(0, 1))
lines(history$metrics$val_accuracy, col = "red")
legend("bottomright", legend = c("Train", "Validation"), col = c("blue", "red"), lty = 1)

# Plot the training & validation loss values
plot(history$metrics$loss, main = "Model Loss", xlab = "Epoch", ylab = "Loss", type = "l", col = "blue")
lines(history$metrics$val_loss, col = "red")
legend("topright", legend = c("Train", "Validation"), col = c("blue", "red"), lty = 1)

# Close the PDF file
dev.off()

# Restore the output to the console
sink()


```

